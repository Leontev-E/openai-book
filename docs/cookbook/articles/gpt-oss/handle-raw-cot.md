---
lang: ru
translationOf: openai-cookbook
---

# Как работать с необработанной цепочкой рассуждений (CoT) в gpt-oss

Модели [gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (Chain of Thought, CoT), предназначенной для анализа и исследований безопасности разработчиками моделей. Это также важно для работы вызова инструментов, так как вызовы инструментов могут выполняться как часть CoT. Вместе с тем, необработанная CoT может содержать потенциально вредоносный контент или раскрывать пользователям информацию, которую разработчик модели не намеревался предоставлять (например, правила, заданные в инструкциях для модели). Поэтому необработанную CoT нельзя показывать конечным пользователям.

## Обработка в шаблонах Harmony / chat

Модель кодирует необработанную CoT как часть нашего [формата отклика harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте собственные шаблоны диалогов или обрабатываете токены напрямую, обязательно [сначала ознакомьтесь с руководством по harmony](https://cookbook.openai.com/articles/openai-harmony).

Кратко по основным моментам:

1. CoT будет передаваться в канал &lt;&lt;&lt;INL_0>>>  
2. После сообщения в канале &lt;&lt;&lt;INL_1>>> на следующем шаге семплирования все сообщения в &lt;&lt;&lt;INL_2>>> следует отбрасывать. Вызовы функций в канале &lt;&lt;&lt;INL_3>>> могут оставаться  
3. Если последнее сообщение ассистента было вызовом инструмента любого типа, сообщения с анализом до предыдущего сообщения &lt;&lt;&lt;INL_4>>> должны сохраняться на последующих шагах семплирования, пока не появится сообщение &lt;&lt;&lt;INL_5>>>

## Chat Completions API

Если вы реализуете Chat Completions API, в опубликованных спецификациях OpenAI нет официального описания работы с цепочкой рассуждений, так как наши размещённые модели пока не поддерживают эту функцию. Мы рекомендуем следовать [следующей конвенции от OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens), которая включает:

1. Необработанная CoT будет возвращаться как часть ответа, если в запросе не указано &lt;&lt;&lt;INL_6>>>. [Подробнее здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)  
2. Необработанная CoT предоставляется в свойстве &lt;&lt;&lt;INL_7>>> объекта сообщения в ответе  
3. Для дельта-событий дельта содержит свойство &lt;&lt;&lt;INL_8>>>  
4. На последующих шагах вы сможете получать предыдущие рассуждения (в виде &lt;&lt;&lt;INL_9>>>) и обрабатывать их согласно поведению, описанному в разделе про шаблоны чата выше.

При сомнениях следуйте конвенции и поведению реализации OpenRouter.

## Responses API

Для Responses API мы расширили спецификацию для обработки этого случая. Ниже приведены изменения в определениях типов. В целом мы:

1. Вводим новое свойство &lt;&lt;&lt;INL_10>>> в &lt;&lt;&lt;INL_11>>>. Это позволяет возвращать рассуждения &lt;&lt;&lt;INL_12>>>, которые можно показывать конечному пользователю одновременно с необработанной CoT (которую показывать нельзя, но она может быть полезна для исследований интерпретируемости).  
2. Вводим новый тип содержимого под именем &lt;&lt;&lt;INL_13>>>  
3. Вводим два новых события: &lt;&lt;&lt;INL_14>>> для потоковой передачи дельт необработанной CoT и &lt;&lt;&lt;INL_15>>> для обозначения завершения шага CoT  
4. На последующих шагах вы сможете получать предыдущие рассуждения и обрабатывать их согласно поведению, описанному в разделе шаблонов чата выше.

**Изменения типов элементов**

&lt;&lt;&lt;CODE_0>>>

**Изменения в событиях**

&lt;&lt;&lt;CODE_1>>>

**Пример вывода ответов**

&lt;&lt;&lt;CODE_2>>>

## Отображение необработанной CoT конечным пользователям

Если вы предоставляете пользователям интерфейс чата, не показывайте им необработанную CoT, так как она может содержать потенциально вредоносный контент или информацию, которую вы не намерены показывать (например, инструкции в сообщениях разработчика). Вместо этого рекомендуем показывать суммированную CoT, аналогично нашим производственным реализациям в API или ChatGPT, где модель-резюматор анализирует и блокирует вредоносный контент перед показом.