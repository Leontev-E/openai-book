---
lang: ru
translationOf: openai-cookbook
---

# Как обрабатывать необработанную цепочку рассуждений (raw chain of thought) в gpt-oss

Модели [gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (CoT), предназначенной для анализа и исследований безопасности разработчиками моделей, но она также важна для производительности вызова инструментов, так как вызовы инструментов могут выполняться как часть CoT. При этом необработанный CoT может содержать потенциально вредоносный контент или раскрывать пользователям информацию, которую человек, реализующий модель, может не хотеть показывать (например, правила, указанные в инструкциях, данных модели). Поэтому необработанный CoT не следует показывать конечным пользователям.

## Обработка в Harmony / шаблонах чата

Модель кодирует необработанный CoT как часть нашего [формата ответа harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте свои шаблоны чатов или работаете с токенами напрямую, обязательно [ознакомьтесь сначала с гайдом по harmony](https://cookbook.openai.com/articles/openai-harmony).

Кратко по основным моментам:

1. CoT будет отправляться в канал &lt;&lt;&lt;INL_0>>>
2. После сообщения в канал &lt;&lt;&lt;INL_1>>> на следующем шаге семплинга все сообщения &lt;&lt;&lt;INL_2>>> должны быть отброшены. Вызовы функций в канал &lt;&lt;&lt;INL_3>>> могут остаться
3. Если последнее сообщение ассистента было вызовом инструмента любого типа, сообщения анализа до предыдущего сообщения &lt;&lt;&lt;INL_4>>> должны сохраняться при последующих запросах до тех пор, пока не будет выдано сообщение &lt;&lt;&lt;INL_5>>>

## Chat Completions API

Если вы реализуете Chat Completions API, официальной спецификации по работе с цепочкой рассуждений в опубликованных спецификациях OpenAI пока нет, так как наши хостинг-модели пока не поддерживают эту функцию. Рекомендуем следовать [следующей конвенции от OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens), которая включает:

1. Необработанный CoT будет возвращён как часть ответа, если в запросе не указан &lt;&lt;&lt;INL_6>>>. [Подробнее здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)
2. Необработанный CoT представлен как свойство &lt;&lt;&lt;INL_7>>> в сообщении ответа
3. Для delta-событий delta содержит свойство &lt;&lt;&lt;INL_8>>>
4. В последующих шагах вы сможете получить предыдущие рассуждения (как &lt;&lt;&lt;INL_9>>>) и обрабатывать их согласно поведению, описанному в разделе про шаблоны чата выше.

В случае сомнений следуйте конвенции и поведению реализации OpenRouter.

## Responses API

Мы расширили спецификацию Responses API для поддержки этого случая. Ниже указаны изменения в спецификации в виде определений типов. В общих чертах мы:

1. Вводим новое свойство &lt;&lt;&lt;INL_10>>> для &lt;&lt;&lt;INL_11>>>. Это позволяет возвращать рассуждения &lt;&lt;&lt;INL_12>>>, которые можно показать конечному пользователю одновременно с необработанным CoT (который не должен показываться пользователю, но может быть полезен для исследований интерпретируемости).
2. Вводим новый тип содержимого, называемый &lt;&lt;&lt;INL_13>>>
3. Вводим два новых события &lt;&lt;&lt;INL_14>>> для потоковой передачи дельт необработанного CoT и &lt;&lt;&lt;INL_15>>> для обозначения окончания шага CoT
4. В последующих шагах вы сможете получать предыдущие рассуждения и обрабатывать их согласно поведению, описанному в разделе про шаблоны чата выше.

**Изменения типа элемента**

&lt;&lt;&lt;CODE_0>>>

**Изменения событий**

&lt;&lt;&lt;CODE_1>>>

**Пример вывода ответов**

&lt;&lt;&lt;CODE_2>>>

## Отображение необработанного CoT конечным пользователям

Если вы предоставляете чат-интерфейс для пользователей, не показывайте необработанный CoT, так как он может содержать потенциально вредоносный контент или другую информацию, которую вы не хотите показывать пользователям (например, инструкции в сообщении для разработчиков). Вместо этого рекомендуется показывать суммированный CoT, как это реализовано в наших продуктивных API и ChatGPT, где модель-сумматор проверяет и блокирует отображение вредоносного контента.