---
lang: ru
translationOf: openai-cookbook
---

# Как обрабатывать необработанную цепочку рассуждений в gpt-oss

[Модели gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (CoT), предназначенной для анализа и исследований безопасности разработчиками моделей, но она также важна для производительности вызова инструментов, так как вызовы инструментов могут выполняться как часть CoT. В то же время, необработанная CoT может содержать потенциально вредоносный контент или раскрывать пользователям информацию, которую внедряющий модель человек не хотел бы показывать (например, правила, указанные в инструкциях, данных модели). Поэтому вы не должны показывать необработанную CoT конечным пользователям.

## Обработка в Harmony / шаблоне чата

Модель кодирует свою необработанную CoT как часть нашего [формата ответа harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте свои собственные шаблоны чата или работаете напрямую с токенами, обязательно [ознакомьтесь сначала с руководством по harmony](https://cookbook.openai.com/articles/openai-harmony).

Кратко подытоживая:

1. CoT будет направлена в канал `analysis`
2. После сообщения в канал `final` на следующем раунде сэмплирования все сообщения `analysis` должны быть удалены. Вызовы функций в канал `commentary` могут оставаться
3. Если последнее сообщение ассистента было вызовом инструмента любого типа, сообщения анализа до предыдущего сообщения `final` должны сохраняться при последующем сэмплировании до выхода нового сообщения `final`

## Chat Completions API

Если вы реализуете Chat Completions API, то в официальной спецификации OpenAI нет спецификации по обработке цепочки рассуждений, поскольку наши хостинговые модели пока не предоставляют эту функцию. Мы просим вас следовать [следующей конвенции OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens). Включая:

1. Необработанная CoT будет возвращаться как часть ответа, если только в запросе не указано `reasoning: { exclude: true }`. [Подробности здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)
2. Необработанная CoT доступна как свойство `reasoning` в сообщении вывода
3. Для дельта-событий дельта содержит свойство `reasoning`
4. В последующих раундах вы должны получать предыдущую цепочку рассуждений (как `reasoning`) и обрабатывать её в соответствии с поведением, описанным в разделе про шаблоны чата выше.

При сомнениях следует ориентироваться на конвенцию / поведение реализации OpenRouter.

## Responses API

Для Responses API мы расширили спецификацию Responses API, чтобы покрыть этот случай. Ниже приведены изменения в спецификации в виде определений типов. В общих чертах мы:

1. Вводим новое свойство `content` у `reasoning`. Это позволяет возвращать сводку рассуждений (`summary`), которую можно показывать конечному пользователю одновременно с необработанной CoT (её не следует показывать конечному пользователю, но она может быть полезна в исследованиях интерпретируемости).
2. Вводим новый тип контента с названием `reasoning_text`
3. Вводим два новых события: `response.reasoning_text.delta` для потоковой передачи дельт необработанной CoT и `response.reasoning_text.done` для указания завершения раунда CoT
4. В последующих раундах вы должны получать предыдущие рассуждения и обрабатывать их в соответствии с поведением, описанным в разделе шаблонов чата выше.

**Изменения в типах элементов**

&lt;&lt;&lt;CODE_0&gt;>>

**Изменения в событиях**

&lt;&lt;&lt;CODE_1&gt;>>

**Пример вывода ответов**

&lt;&lt;&lt;CODE_2&gt;>>

## Отображение необработанной CoT конечным пользователям

Если вы предоставляете чат-интерфейс пользователям, не показывайте необработанную CoT, так как она может содержать потенциально вредоносный контент или другую информацию, которую вы не хотите показывать пользователям (например, инструкции в сообщении разработчика). Вместо этого мы рекомендуем показывать свёрнутую CoT, аналогично нашим промышленным реализациям в API или ChatGPT, где модель-суммаризатор проверяет и блокирует вредоносный контент для показа.