---
lang: ru
translationOf: openai-cookbook
---

# Как работать с необработанной цепочкой рассуждений в gpt-oss

Модели [gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (CoT), предназначенной для анализа и исследований по безопасности разработчиками модели, но она также важна для работы с вызовом инструментов, так как вызовы инструментов могут выполняться как часть CoT. В то же время, необработанная CoT может содержать потенциально вредоносный контент или раскрывать пользователям информацию, которую разработчик модели намеренно не хотел показывать (например, правила, заданные в инструкциях для модели). Поэтому необработанную CoT не следует показывать конечным пользователям.

## Обработка в Harmony / шаблон чата

Модель кодирует свою необработанную CoT как часть нашего [формата ответа harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте собственные шаблоны чата или работаете напрямую с токенами, обязательно [сначала ознакомьтесь с руководством по harmony](https://cookbook.openai.com/articles/openai-harmony).

Кратко по основным моментам:

1. CoT будет отправлена в канал &lt;&lt;&lt;INL_0>>>
2. После сообщения в канал &lt;&lt;&lt;INL_1>>> при следующем раунде сэмплинга все сообщения &lt;&lt;&lt;INL_2>>> должны быть отброшены. Вызовы функций в канал &lt;&lt;&lt;INL_3>>> могут сохраняться
3. Если последнее сообщение ассистента представляло собой вызов инструмента любого типа, сообщения анализа до предыдущего сообщения &lt;&lt;&lt;INL_4>>> должны сохраняться при последующем сэмплинге, пока не будет выдано сообщение &lt;&lt;&lt;INL_5>>>

## Chat Completions API

Если вы реализуете API для Chat Completions, в опубликованных спецификациях OpenAI нет официального стандарта для обработки цепочки рассуждений, так как наши размещённые модели пока не поддерживают эту функцию. Мы рекомендуем использовать [следующий конвенциональный подход от OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens). В частности:

1. Необработанная CoT возвращается как часть ответа, если в запросе не указан параметр &lt;&lt;&lt;INL_6>>>. [Подробности здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)
2. Необработанная CoT доступна как свойство &lt;&lt;&lt;INL_7>>> в сообщении ответа
3. Для дельта-событий дельта содержит свойство &lt;&lt;&lt;INL_8>>>
4. В последующих шагах вы можете получить предыдущие рассуждения (в виде &lt;&lt;&lt;INL_9>>>) и обрабатывать их в соответствии с поведением, описанным выше в разделе о шаблонах чата.

В случае сомнений следуйте конвенциям и поведению реализации OpenRouter.

## Responses API

Для Responses API мы расширили спецификацию с учётом этого случая. Ниже представлены изменения в спецификации в виде определений типов. В целом мы:

1. Вводим новое свойство &lt;&lt;&lt;INL_10>>> у объекта &lt;&lt;&lt;INL_11>>>. Это позволяет возвращать рассуждения &lt;&lt;&lt;INL_12>>>, которые могут отображаться конечному пользователю, одновременно с необработанной CoT (которую показывать не следует, но она может быть полезна для исследований интерпретируемости).
2. Вводим новый тип содержимого с названием &lt;&lt;&lt;INL_13>>>
3. Вводим два новых события: &lt;&lt;&lt;INL_14>>> для стриминга дельт необработанной CoT и &lt;&lt;&lt;INL_15>>> для указания окончания шага рассуждения CoT
4. В следующих раундах сэмплинга можно получать предыдущие рассуждения и обрабатывать их в соответствии с поведением, описанным выше в разделе о шаблонах чата.

**Изменения в типах элементов**

&lt;&lt;&lt;CODE_0>>>

**Изменения в событиях**

&lt;&lt;&lt;CODE_1>>>

**Пример вывода ответов**

&lt;&lt;&lt;CODE_2>>>

## Отображение необработанной CoT конечным пользователям

Если вы предоставляете пользователям чат-интерфейс, не показывайте необработанную CoT, так как она может содержать потенциально вредоносный контент или другую информацию, которую вы не хотите демонстрировать пользователям (например, инструкции в системном сообщении разработчика). Вместо этого рекомендуем показывать обобщённую CoT, аналогично тем решениям, что используются в продакшн-реализациях API или ChatGPT, где модель-резюме просматривает и блокирует вредоносный контент перед отображением.