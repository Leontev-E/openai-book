---
lang: ru
translationOf: openai-cookbook
---

# Как обрабатывать необработанную цепочку рассуждений (raw chain of thought) в gpt-oss

Модели [gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (CoT) для анализа и исследований по безопасности со стороны разработчиков моделей, но это также важно для работы вызова инструментов, поскольку вызовы инструментов могут выполняться как часть CoT. При этом необработанная CoT может содержать потенциально вредоносный контент либо раскрывать пользователям информацию, которую реализующий модель может не намереваться показывать (например, правила, заданные в инструкциях для модели). Поэтому необработанную CoT не следует показывать конечным пользователям.

## Обработка в harmony / шаблоне чата

Модель кодирует необработанную CoT как часть нашего [формата ответа harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте свои собственные шаблоны чата или работаете напрямую с токенами, обязательно [сначала ознакомьтесь с руководством harmony](https://cookbook.openai.com/articles/openai-harmony).

Краткое резюме:

1. CoT будет передаваться в канал &lt;&lt;&lt;INL_0>>>
2. После сообщения в канал &lt;&lt;&lt;INL_1>>> на следующем раунде сэмплирования все сообщения &lt;&lt;&lt;INL_2>>> должны быть удалены. Вызовы функций в канал &lt;&lt;&lt;INL_3>>> могут оставаться
3. Если последнее сообщение ассистента было вызовом инструмента любого типа, сообщения анализа до предыдущего сообщения &lt;&lt;&lt;INL_4>>> должны сохраняться при последующих сэмплированиях, пока не будет отправлено сообщение &lt;&lt;&lt;INL_5>>>

## Chat Completions API

Если вы реализуете Chat Completions API, то в опубликованных спецификациях OpenAI нет официальных требований по обработке цепочки рассуждений, поскольку наши размещённые модели пока не поддерживают эту функцию. Мы рекомендуем вам использовать [следующую конвенцию от OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens). В частности:

1. Необработанная CoT будет возвращаться как часть ответа, если в запросе не указан параметр &lt;&lt;&lt;INL_6>>>. [Подробности здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)
2. Необработанная CoT доступна как свойство сообщения &lt;&lt;&lt;INL_7>>> в ответе
3. Для событий дельты дельта содержит свойство &lt;&lt;&lt;INL_8>>>
4. В последующих вызовах можно будет получить предыдущие рассуждения (как &lt;&lt;&lt;INL_9>>>) и обрабатывать их в соответствии с поведением, описанным в разделе о шаблонах чата выше.

В случае сомнений следуйте конвенциям и поведению реализации OpenRouter.

## Responses API

Для Responses API мы расширили спецификацию, чтобы покрыть этот случай. Ниже приведены изменения спецификации в виде определений типов. В общем:

1. Вводится новое свойство &lt;&lt;&lt;INL_10>>> в &lt;&lt;&lt;INL_11>>>. Это позволяет возвращать представление рассуждений &lt;&lt;&lt;INL_12>>>, которое может показываться конечному пользователю, одновременно с необработанной CoT (которую показывать пользователю не следует, но она может быть полезна для исследований интерпретируемости).
2. Вводится новый тип контента под названием &lt;&lt;&lt;INL_13>>>
3. Вводятся два новых события: &lt;&lt;&lt;INL_14>>> для передачи дельт необработанной CoT и &lt;&lt;&lt;INL_15>>> для индикатора завершения раунда CoT
4. В последующих раундах можно получать предыдущие рассуждения и обрабатывать их согласно поведению, описанному в разделе шаблонов чата.

**Изменения в типах элементов**

&lt;&lt;&lt;CODE_0>>>

**Изменения в событиях**

&lt;&lt;&lt;CODE_1>>>

**Пример вывода ответов**

&lt;&lt;&lt;CODE_2>>>

## Отображение необработанной CoT конечным пользователям

Если вы предоставляете интерфейс чата для пользователей, не показывайте необработанную CoT, так как она может содержать потенциально опасный контент или другую информацию, которую вы могли бы не хотеть раскрывать пользователям (например, инструкции в системном сообщении разработчика). Вместо этого рекомендуем показывать резюмированную CoT, как в наших продуктивных реализациях в API или ChatGPT, где модель-резюматор проверяет и блокирует вредоносный контент перед показом.