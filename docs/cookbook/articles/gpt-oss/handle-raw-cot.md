---
lang: ru
translationOf: openai-cookbook
---

# Как обрабатывать необработанную цепочку рассуждений в gpt-oss

Модели [gpt-oss](https://openai.com/open-models) предоставляют доступ к необработанной цепочке рассуждений (CoT), предназначенной для анализа и исследований безопасности разработчиками моделей, но она также важна для работы вызова инструментов, так как вызовы инструментов могут выполняться как часть CoT. При этом необработанная CoT может содержать потенциально вредоносный контент или раскрывать пользователям информацию, которую разработчик модели может не хотеть показывать (например, правила, заданные в инструкциях модели). Поэтому необработанную CoT не следует показывать конечным пользователям.

## Обработка в шаблоне Harmony / чата

Модель кодирует свою необработанную CoT как часть нашего [формата ответа harmony](https://cookbook.openai.com/articles/openai-harmony). Если вы создаёте собственные шаблоны чата или напрямую работаете с токенами, обязательно [ознакомьтесь сначала с руководством по harmony](https://cookbook.openai.com/articles/openai-harmony).

Кратко по сути:

1. CoT будет отправлена в канал `analysis`
2. После сообщения в канал `final` на следующем шаге выборки все сообщения `analysis` следует обнулить. Вызовы функций в канал `commentary` могут оставаться
3. Если последнее сообщение помощника было вызовом инструмента любого типа, аналитические сообщения вплоть до предыдущего сообщения `final` должны сохраняться на следующих шагах выборки до тех пор, пока не будет отправлено сообщение `final`

## Chat Completions API

Если вы реализуете Chat Completions API, то в опубликованных спецификациях OpenAI нет официальных указаний по работе с цепочкой рассуждений, поскольку наши размещённые модели пока не предоставляют эту функцию. Мы просим вас следовать [следующему соглашению от OpenRouter](https://openrouter.ai/docs/use-cases/reasoning-tokens). В частности:

1. Необработанная CoT будет возвращаться как часть ответа, если в запросе не указан параметр `reasoning: { exclude: true }`. [Подробнее здесь](https://openrouter.ai/docs/use-cases/reasoning-tokens#legacy-parameters)
2. Необработанная CoT представлена как свойство `reasoning` в сообщении в выводе
3. Для дельта-событий дельта содержит свойство `reasoning`
4. В следующих шагах вы должны иметь возможность получать предыдущие рассуждения (как `reasoning`) и обрабатывать их в соответствии с поведением, описанным в разделе шаблонов чата выше.

В случае сомнений следуйте соглашениям и поведению реализации OpenRouter.

## Responses API

В Responses API мы дополнили спецификацию под этот случай. Ниже приведены изменения в виде определений типов. В целом мы:

1. Вводим новое свойство `content` в `reasoning`. Это позволяет возвращать рассуждения `summary`, которые могут быть показаны конечному пользователю, одновременно с необработанной CoT (которую показывать не следует, но которая может быть полезна для исследований по интерпретируемости).
2. Вводим новый тип содержимого с именем `reasoning_text`
3. Вводим два новых события `response.reasoning_text.delta` для потоковой передачи дельт необработанной CoT и `response.reasoning_text.done` для указания завершения шага CoT
4. В следующих ходах вы должны иметь возможность получать предыдущие рассуждения и обрабатывать их в соответствии с поведением, описанным в разделе шаблонов чата выше.

**Изменения в типах элементов**

&lt;&lt;&lt;FENCE_0>>>

**Изменения в событиях**

&lt;&lt;&lt;FENCE_1>>>

**Пример вывода ответов**

&lt;&lt;&lt;FENCE_2>>>

## Отображение необработанной CoT конечным пользователям

Если вы предоставляете пользователям интерфейс чата, не показывайте необработанную CoT, так как она может содержать потенциально вредоносный контент или другую информацию, которую вы не хотите показывать пользователям (например, инструкции в сообщении разработчика). Вместо этого рекомендуем показывать суммированную CoT, как в наших производственных реализациях в API или ChatGPT, где модель-сумматор проверяет и блокирует показ вредоносного контента.